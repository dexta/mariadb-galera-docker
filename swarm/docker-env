#!/bin/bash

if [ -z $DOCKER_CERT_PATH ]; then
  echo "Using default legacy certificate path... soon to be deprecated!!!"
  export DOCKER_CERT_PATH=./api-certs

  if [ ! -f ./api-certs/cert.pem ]; then
    echo
    echo "Can't find the api-certs required to connect to the swarm manager api!"
    echo "Please ensure that the following certificats exist in the api-certs folder:"
    echo 
    echo "ca.pem"
    echo "cert.pem"
    echo "key.pem"
    echo
    echo "Note: These are generated by cluster-builder during swarm creation."
    echo
    exit 1
  fi
fi

if [ -z $DOCKER_HOST ]; then 
  echo 
  echo "DOCKER_HOST is not set"
  echo "Make sure to set the DOCKER_HOST env variable to your swarm manager."
  exit 1
fi

export DOCKER_TLS_VERIFY=1

docker $@

